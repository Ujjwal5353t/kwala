<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <title>Starknet Contract Auditor</title>
        <script src="https://cdn.tailwindcss.com"></script>
    </head>
    <body
        class="bg-gray-100 min-h-screen flex flex-col items-center justify-center p-4"
    >
        <div class="bg-white p-8 rounded-lg shadow-md w-full max-w-4xl">
            <h1 class="text-2xl font-bold mb-6 text-center">
                Starknet Smart Contract Auditor
            </h1>
            <form id="auditForm" class="space-y-4">
                <textarea
                    id="contractCode"
                    rows="10"
                    class="w-full p-2 border rounded-md font-mono text-sm"
                    placeholder="Paste your Cairo smart contract code here..."
                ></textarea>
                <button
                    type="submit"
                    class="w-full bg-blue-500 text-white py-2 rounded-md hover:bg-blue-600 transition"
                >
                    Audit Contract
                </button>
            </form>
            <div id="reportContainer" class="mt-6 hidden">
                <div class="grid grid-cols-2 gap-4">
                    <div>
                        <h2 class="text-xl font-semibold mb-4">
                            Original Code
                        </h2>
                        <pre
                            id="originalCodeContent"
                            class="bg-gray-50 p-4 rounded-md overflow-auto font-mono text-xs"
                        ></pre>
                    </div>
                    <div>
                        <h2 class="text-xl font-semibold mb-4">
                            Corrected Code
                        </h2>
                        <pre
                            id="correctedCodeContent"
                            class="bg-gray-50 p-4 rounded-md overflow-auto font-mono text-xs"
                        ></pre>
                    </div>
                </div>
                <div class="mt-4">
                    <h2 class="text-xl font-semibold mb-4">Audit Details</h2>
                    <pre
                        id="reportContent"
                        class="bg-gray-50 p-4 rounded-md overflow-auto"
                    ></pre>
                </div>
            </div>
        </div>

        <script>
            document
                .getElementById("auditForm")
                .addEventListener("submit", async (e) => {
                    e.preventDefault();
                    const contractCode =
                        document.getElementById("contractCode").value;
                    const reportContainer =
                        document.getElementById("reportContainer");
                    const reportContent =
                        document.getElementById("reportContent");
                    const originalCodeContent = document.getElementById(
                        "originalCodeContent"
                    );
                    const correctedCodeContent = document.getElementById(
                        "correctedCodeContent"
                    );

                    try {
                        const response = await fetch("/audit", {
                            method: "POST",
                            headers: {
                                "Content-Type": "application/json",
                            },
                            body: JSON.stringify({ contractCode }),
                        });

                        const result = await response.json();

                        reportContainer.classList.remove("hidden");

                        // Display original and corrected code side by side
                        originalCodeContent.textContent =
                            result.report.original_contract_code;
                        correctedCodeContent.textContent =
                            result.report.corrected_contract_code;

                        // Display audit report details
                        reportContent.textContent = JSON.stringify(
                            result.report,
                            null,
                            2
                        );
                    } catch (error) {
                        reportContainer.classList.remove("hidden");
                        reportContent.textContent = `Error: ${error.message}`;
                    }
                });
        </script>
    </body>
</html>
